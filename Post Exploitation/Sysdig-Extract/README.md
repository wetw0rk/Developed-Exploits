# Sysdig-Extract

This script will attempt to extract the following from a SysDig `.scap` capture file.

- API Endpoint
- API Endpoint Port
- Account Tokens
- Account CA Certificates

Once found an attempt will be made to exec into a pod with each token and ca.crt. For best results use a capture size of 1800.

## Usage Example

```
root@wetw0rk:~$ ./sysdig_extract.py half_hour_cap.scap
[+] endpoint found: https://XXX.XXXXX.XXXXXX.XXXXX.XXXXX.com
        [+] possible endpoint port located XXXXX
        [+] possible endpoint port located XXXXX
[+] summary of findings shown below (false positives in red)
        ACCOUNT                                  TOKEN PROOF     CERT PROOF     
        kube-dns-token-XXXXX                     eyJhbGci        BEGIN CERTIFICATE
        default-token-XXXXX                      eyJhbGci        BEGIN CERTIFICATE
        kubernetes.io                            eyJhbGci        BEGIN CERTIFICATE
        heapster-token-XXXXX                     eyJhbGci        BEGIN CERTIFICATE
        sysdig-agent-token-XXXXX                 eyJhbGci        BEGIN CERTIFICATE
        kube-dns-autoscaler-token-XXXXX          eyJhbGci        BEGIN CERTIFICATE
        XXXXXX-kube-fluentd-token-XXXXX          eyJhbGci        BEGIN CERTIFICATE
        kubernetes-dashboard-token-XXXXX         eyJhbGci        BEGIN CERTIFICATE
        etcd-certs                               eyJhbGci        BEGIN CERTIFICATE
        XXXX-keepalived-watcher-token-XXXX       eyJhbGci        BEGIN CERTIFICATE
        calico-node-token-XXXXX                  eyJhbGci        BEGIN CERTIFICATE
        sysdig-agent-token-XXXXX                 eyJhbGci        BEGIN CERTIFICATE
        calico-kube-controllers-token-XXXXX      eyJhbGci        BEGIN CERTIFICATE
        system.slice                             eyJhbGci        BEGIN CERTIFICATE
        kubernetes.io~secret                     eyJhbGci        BEGIN CERTIFICATE
        sysdig-agent-config                      eyJhbGci        BEGIN CERTIFICATE
        sysdig-agent-secrets                     eyJhbGci        BEGIN CERTIFICATE
        terminfo                                 eyJmc           BEGIN CERTIFICATE
        ACCOUNT                                  TOKEN PROOF     CERT PROOF     
        [M                                       eyJhbGci        BEGIN CERTIFICATE
        {"pid":13743,"level":"info","m           eyJhbGci        BEGIN CERTIFICATE
        20XX-XX-XX 1Y:33:53.690, 13738           eyJhbGci        BEGIN CERTIFICATE
                                                 eyJhbGci        BEGIN CERTIFICATE
        20XX-XX-XX 1Y:39:53.688, 13738           eyJhbGci        BEGIN CERTIFICATE
        XX>                                      eyJhbGci        BEGIN CERTIFICATE
        X                                        eyJhbGci        BEGIN CERTIFICATE
        20XX-XX-XX 1Y:57:53.674, 13738           eyJhbGci        BEGIN CERTIFICATE
[+] extracting findings into "loot" directory
[-] previously discovered entry:
[*] starting exec checks on all discovered accounts
[*] using https://XXX.XXXXX.XXXXXX.XXXXX.XXXXX.com:XXX as our target endpoint (if fails try other possible ports)
[+] summary of findings shown below
        ACCOUNT                                  CAN EXEC       
        sysdig-agent-token-XXXXX                 no
        default-token-XXXXX                      yes
        etcd-certs                               no
        sysdig-agent-config                      no
        sysdig-agent-token-XXXXX                 no
        XXXX-kube-fluentd-token-XXXXX            ERROR
        XXXX-keepalived-watcher-token-X          no
        heapster-token-XXXXX                     ERROR
        system.slice                             ERROR
        terminfo                                 ERROR
        kube-dns-autoscaler-token-XXXX           no
        calico-node-token-XXXXX                  no
        kubernetes.io~secret                     no
        kube-dns-token-XXXXX                     ERROR
        kubernetes.io                            no
        calico-kube-controllers-token-           no
        sysdig-agent-secrets                     no
        kubernetes-dashboard-token-XXX           no
        ACCOUNT                                  CAN EXEC       
        [M                                       no
        20XX-XX-XX 1Y:39:53.688, 13738           ERROR
        20XX-XX-XX 1Y:57:53.674, 13738           no
        XX                                       ERROR
        {"pid":13743,"level":"info","m           no
        X                                        no
        20XX-XX-XX 1Y:33:53.690, 13738           no

```
